import{s as h}from"./config.data.00d5da9c.js";import{_}from"./_plugin-vue_export-helper.c27b6911.js";import{d as y,o as v,c as w,C as $,a as U}from"./runtime-core.esm-bundler.4c672f88.js";const b={"Content-Type":"application/json"},R=({serverURL:e,lang:t,paths:n,signal:r})=>(({serverURL:a,lang:i,paths:l,type:p,signal:c})=>fetch(`${a}/article?path=${encodeURIComponent(l.join(","))}&type=${encodeURIComponent(p.join(","))}&lang=${i}`,{signal:c}).then(o=>o.json()))({serverURL:e,lang:t,paths:n,type:["time"],signal:r}).then(a=>Array.isArray(a)?a:[a]),x=e=>(({serverURL:t,lang:n,path:r,type:a,action:i})=>fetch(`${t}/article?lang=${n}`,{method:"POST",headers:b,body:JSON.stringify({path:r,type:a,action:i})}).then(l=>l.json()))({...e,type:"time",action:"inc"}),u=e=>{const t=((n="")=>n.replace(/\/$/u,""))(e);return/^(https?:)?\/\//.test(t)?t:`https://${t}`},A=e=>{e.name!=="AbortError"&&console.error(e.message)},d=e=>e.dataset.path||e.getAttribute("id"),f=(e,t)=>{t.forEach((n,r)=>{n.innerText=e[r].toString()})},m=({serverURL:e,path:t=window.location.pathname,selector:n=".waline-pageview-count",update:r=!0,lang:a=navigator.language})=>{const i=new AbortController,l=Array.from(document.querySelectorAll(n)),p=o=>{const s=d(o);return s!==null&&t!==s},c=o=>R({serverURL:u(e),paths:o.map(s=>d(s)||t),lang:a,signal:i.signal}).then(s=>f(s,o)).catch(A);if(r){const o=l.filter(g=>!p(g)),s=l.filter(p);x({serverURL:u(e),path:t,lang:a}).then(g=>f(new Array(o.length).fill(g),o)),s.length&&c(s)}else c(l);return i.abort.bind(i)},C={__name:"PageView",props:{path:String,visible:Boolean},setup(e,{expose:t}){t();const n=e;y(()=>{n.visible&&m({serverURL:h.serverUrl,path:n.path,update:/^(louisfiy.com)/.test(window.location.hostname)})});const r={props:n,get pageviewCount(){return m},get siteConfig(){return h}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}},L={class:"text-xs text-gray-500"},S=U("span",{class:"waline-pageview-count"},"0",-1);function j(e,t,n,r,a,i){return v(),w("span",L,[S,$("阅读")])}const V=_(C,[["render",j]]);export{V as default};
