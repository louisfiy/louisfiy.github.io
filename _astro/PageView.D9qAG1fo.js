import{s as c}from"./config.data.BJSHlIL0.js";import{_}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{c as v,b as w,B as U,d as b,o as R}from"./runtime-core.esm-bundler.BKfUd-U8.js";const x={"Content-Type":"application/json"},$=e=>`${e.replace(/\/?$/,"/")}api/`,y=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`${t} failed with ${e.errno}: ${e.errmsg}`);return e},L=({serverURL:e,lang:t,paths:n,type:r,signal:a})=>fetch(`${$(e)}article?path=${encodeURIComponent(n.join(","))}&type=${encodeURIComponent(r.join(","))}&lang=${t}`,{signal:a}).then(e=>e.json()).then(e=>y(e,"Get counter").data),S=({serverURL:e,lang:t,path:n,type:r,action:a})=>fetch(`${$(e)}article?lang=${t}`,{method:"POST",headers:x,body:JSON.stringify({path:n,type:r,action:a})}).then(e=>e.json()).then(e=>y(e,"Update counter").data),j=({serverURL:e,lang:t,paths:n,signal:r})=>L({serverURL:e,lang:t,paths:n,type:["time"],signal:r}),C=e=>S({...e,type:"time",action:"inc"}),B=(e="")=>e.replace(/\/$/u,""),T=e=>/^(https?:)?\/\//.test(e),h=e=>{const t=B(e);return T(t)?t:`https://${t}`},A=e=>{"AbortError"!==e.name&&console.error(e.message)},d=e=>{const{path:t}=e.dataset;return null!=t&&t.length?t:null},f=(e,t)=>{t.forEach((t,n)=>{const r=e[n].time;"number"==typeof r&&(t.innerText=r.toString())})},m=({serverURL:e,path:t=window.location.pathname,selector:n=".waline-pageview-count",update:r=!0,lang:a=navigator.language})=>{const o=new AbortController,s=Array.from(document.querySelectorAll(n)),i=e=>{const n=d(e);return null!==n&&t!==n},p=n=>j({serverURL:h(e),paths:n.map(e=>d(e)??t),lang:a,signal:o.signal}).then(e=>f(e,n)).catch(A);if(r){const n=s.filter(e=>!i(e)),r=s.filter(i);C({serverURL:h(e),path:t,lang:a}).then(e=>f(e,n)),r.length&&p(r)}else p(s);return o.abort.bind(o)},E={__name:"PageView",props:{path:String,visible:Boolean},setup(e,{expose:t}){t();const n=e;b(()=>{n.visible&&m({serverURL:c.serverUrl,path:n.path,update:c.isSiteUpdate()})});const r={props:n,get pageviewCount(){return m},get siteConfig(){return c}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}},P={class:"text-xs text-gray-500"};function V(e,t,n,r,a,o){return R(),v("span",P,[...t[0]||(t[0]=[w("span",{class:"waline-pageview-count"},"0",-1),U("阅读",-1)])])}const I=_(E,[["render",V]]);export{I as default};