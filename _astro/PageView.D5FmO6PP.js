import{s as u}from"./config.data.DO7T5YQ5.js";import{_}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as v,c as w,a as U,y as b,o as R}from"./runtime-core.esm-bundler.Cq7U_nTZ.js";const x={"Content-Type":"application/json"},y=e=>`${e.replace(/\/?$/,"/")}api/`,$=(e,t="")=>{if(typeof e=="object"&&e.errno)throw new TypeError(`${t} failed with ${e.errno}: ${e.errmsg}`);return e},L=({serverURL:e,lang:t,paths:n,type:r,signal:o})=>fetch(`${y(e)}article?path=${encodeURIComponent(n.join(","))}&type=${encodeURIComponent(r.join(","))}&lang=${t}`,{signal:o}).then(a=>a.json()).then(a=>$(a,"Get counter").data),j=({serverURL:e,lang:t,path:n,type:r,action:o})=>fetch(`${y(e)}article?lang=${t}`,{method:"POST",headers:x,body:JSON.stringify({path:n,type:r,action:o})}).then(a=>a.json()).then(a=>$(a,"Update counter").data),S=({serverURL:e,lang:t,paths:n,signal:r})=>L({serverURL:e,lang:t,paths:n,type:["time"],signal:r}),C=e=>j({...e,type:"time",action:"inc"}),T=(e="")=>e.replace(/\/$/u,""),A=e=>/^(https?:)?\/\//.test(e),h=e=>{const t=T(e);return A(t)?t:`https://${t}`},B=e=>{e.name!=="AbortError"&&console.error(e.message)},d=e=>{const{path:t}=e.dataset;return t!=null&&t.length?t:null},f=(e,t)=>{t.forEach((n,r)=>{const o=e[r].time;typeof o=="number"&&(n.innerText=o.toString())})},m=({serverURL:e,path:t=window.location.pathname,selector:n=".waline-pageview-count",update:r=!0,lang:o=navigator.language})=>{const a=new AbortController,p=Array.from(document.querySelectorAll(n)),c=i=>{const s=d(i);return s!==null&&t!==s},g=i=>S({serverURL:h(e),paths:i.map(s=>d(s)??t),lang:o,signal:a.signal}).then(s=>f(s,i)).catch(B);if(r){const i=p.filter(l=>!c(l)),s=p.filter(c);C({serverURL:h(e),path:t,lang:o}).then(l=>f(l,i)),s.length&&g(s)}else g(p);return a.abort.bind(a)},E={__name:"PageView",props:{path:String,visible:Boolean},setup(e,{expose:t}){t();const n=e;v(()=>{n.visible&&m({serverURL:u.serverUrl,path:n.path,update:/^(louisfiy.com)/.test(window.location.hostname)})});const r={props:n,get pageviewCount(){return m},get siteConfig(){return u}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}},P={class:"text-xs text-gray-500"};function V(e,t,n,r,o,a){return R(),w("span",P,t[0]||(t[0]=[U("span",{class:"waline-pageview-count"},"0",-1),b("阅读")]))}const I=_(E,[["render",V]]);export{I as default};
